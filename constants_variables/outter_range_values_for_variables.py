from constants_variables.features_lists import LAB_VARIABLES, CHART_VARIABLES
from collections import defaultdict

clean_fns = {50816: [21, 100],  # FIO2
             50868: [0, 10000],  # ANION GAP
             51006: [0, 300],  # UREA NITROGEN
             50862: [0, 10],  # ALBUMIN
             51275: [0, 150],  # PTT
             51265: [0, 10000],  # PLATELET COUNT
             51301: [0, 1000],  # WBC
             51300: [0, 1000],  # WBC
             50817: [0, 100],  # OXYGEN SATURATION
             50912: [0, 150],  # CREATININE
             50813: [0, 50],  # LACTATE
             50821: [0, 800],  # PO2
             50815: [0, 70],  # O2 FLOW
             51237: [0, 50],  # INR(PT)
             50885: [0, 150],  # BILIRUBIN
             51274: [0, 150],  # PT
             50893: [0, 300],  # CALCIUM, TOTAL
             50970: [0, 300],  # PHOSPHATE
             # POTASSIUM
             50971: [0, 30], 50822: [0, 30],
             # SODIUM
             50983: [0, 200], 50824: [0, 200],
             # GLUCOSE
             50809: [0, 1000], 50931: [0, 1000],  # GLUCOSE
             # HEMOGLOBIN
             50811: [0, 50], 51222: [0, 50],  #HEMOGLOBIN
             # HEMATOCRIT
             51221: [0, 100], 50810: [0, 100],  # HEMATOCRIT
             # CHLORIDE, URINE",
             51078: [0, 1000], 50902: [0, 1000], 50806: [0, 1000],  # CHLORIDE
             # BICARBONATE
             50882: [0, 1000], 50803: [0, 1000]  # BICARBONATE
             }

clean_fns_chart_var = {  # HeartRate
    211: [1, 350], 220045: [0, 350], 51: [1, 350], 442: [1, 350], 455: [1, 350], 6701: [1, 350],
    220179: [1, 350], 220050: [1, 350],
    # DIASTOLIC BLOOD PRESSURE
    8368: [1, 300], 8440: [1, 300], 8441: [1, 300], 8555: [1, 300], 220180: [1, 300],
    220051: [1, 300], 8502: [1, 300],
    # MEAN ARTERIAL BLOOD PRESSURE
    456: [1, 300], 52: [1, 300], 6702: [1, 300], 443: [1, 300], 220052: [1, 300], 220181: [1, 300],
    225312: [1, 300], 224: [1, 300], 224322: [1, 300], 3312: [1, 300],
    # O2 saturation pulseoxymetry SpO2
    646: [1, 100], 220277: [1, 100],
    # GLUCOSE
    807: [1, 1000], 811: [1, 1000], 1529: [1, 1000], 3745: [1, 1000], 3744: [1, 1000],
    225664: [1, 1000], 220621: [1, 1000], 226537: [1, 1000],
    # O2 FLOW
    470: [1, 70], 471: [1, 70], 227287: [1, 70], 223834: [1, 70], 227582: [1, 70], 224691: [1, 70],
    # OXYGEN SATURATION
}

MAPPING_LABEVENTS_VAR = {
    50816: 'FIO2', 50868: 'ANION_GAP', 50814: 'METHEMOGLOBIN', 51006: 'UREA', 50862: 'ALBUMIN',
    51275: 'PTT', 51009: 'VANCOMYCIN_LEVEL', 51265: 'PLATELET_COUNT', 50970: 'PHOSPHATE', 51301: 'WBC', 51300: 'WBC',
    51279: 'RBC', 50817: 'SaO2', 50802: "BASE_EXCESS", 50912: 'CREATININE', 50813: 'LACTATE', 50867: "AMYLASE",
    50956: "LIPASE", 50954: "LDH", 51144: "BANDS", 50976: "PROTEIN_TOTAL", 50924: "FERRITIN", 50953: "TIBC",
    50998: "TRANSFERRIN",
    50821: "PO2", 50815: "O2_FLOW", 50818: "PCO2", 51248: "MCH", 51249: "MCHC", 51250: "MCV", 51237: "INR(PT)",
    50885: "BILIRUBIN", 50960: "MAGNESIUM", 51003: "TROPONIN_T", 50804: "CALCULATED_TOTAL_CO2", 51274: "PT",
    50893: 'CALCIUM_TOTAL',
    50823: "REQUIRED_O2", 50805: "CARBOXYHEMOGLOBIN", 51498: "SPECIFIC_GRAVITY", 51484: "KETONE", 51514: "UROBILINOGEN",
    51196: "D-DIMER", 51214: "FIBRINOGEN", 51297: "THROMBIN", 50911: "CKâ€“MB_ISOENZYME", 50971: 'POTASSIUM',
    50822: 'POTASSIUM', 50983: 'SODIUM', 51100: 'SODIUM', 50824: "SODIUM", 50861: "ALT", 50878: "AST",
    51221: 'HEMATOCRIT',
    50810: 'HEMATOCRIT', 51078: "CHLORIDE", 50902: "CHLORIDE", 50806: "CHLORIDE", 50882: 'BICARBONATE',
    50803: "BICARBONATE",
    51218: "GRANULOCYTE_COUNT", 51255: "MYELOCYTES", 51256: "NEUTROPHILS", 51143: "ATYPICAL_LYMPHOCYTES",
    51251: "METAMYELOCYTES",
    51146: 'BASOPHILS', 51122: "NUCLEATED_RBC", 51257: "NUCLEATED_RBC", 51476: "EPITHELIAL_CELLS", 51116: "LYMPHOCYTES",
    51244: "LYMPHOCYTES",
    51375: "LYMPHOCYTES", 51427: "LYMPHOCYTES", 51446: "LYMPHOCYTES", 51254: "MONOCYTES", 51120: "MONOCYTES",
    51355: "MONOCYTES", 51379: "MONOCYTES",
    51200: "EOSINOPHILS", 51114: "EOSINOPHILS", 51200: "EOSINOPHILS", 51347: "EOSINOPHILS", 51368: "EOSINOPHILS",
    51419: "EOSINOPHILS", 51444: "EOSINOPHILS",
    51126: "PROMYELOCYTES", 51269: "PROMYELOCYTES", 51361: "PROMYELOCYTES", 51437: "PROMYELOCYTES",
    51456: "PROMYELOCYTES", 51283: "RETICULOCYTE_COUNT",
    51284: "RETICULOCYTE_COUNT", 50809: "GLUCOSE", 50931: "GLUCOSE", 51478: "GLUCOSE", 50811: "HEMOGLOBIN",
    51222: "HEMOGLOBIN", 50820: "PH",
    50831: "PH", 51094: "PH", 51491: "PH", 50825: 'TEMPERATURE'}

MAPPING_CHARTEVENTS_VAR = {
    723: 'GCS_VERBAL', 223900: "GCS_VERBAL", 454: 'GCS_MOTOR', 223901: "GCS_MOTOR", 184: 'GCS_EYES', 220739: "GCS_EYES",
    211: "HEART_RATE", 220045: "HEART_RATE", 676: "TEMPERATURE", 677: "TEMPERATURE", 678: "TEMPERATURE",
    679: "TEMPERATURE", 3654: 'TEMPERATURE', 3655: "TEMPERATURE", 223761: "TEMPERATURE", 223762: "TEMPERATURE",
    3420: "FIO2", 190: "FIO2",
    223835: "FIO2", 3422: "FIO2", 51: "SYSTOLIC_BLOOD", 442: "SYSTOLIC_BLOOD", 455: "SYSTOLIC_BLOOD",
    3313: "SYSTOLIC_BLOOD",
    6701: "SYSTOLIC_BLOOD", 220179: "SYSTOLIC_BLOOD", 220050: "SYSTOLIC_BLOOD", 8368: "DIASTOLIC_BLOOD",
    8440: "DIASTOLIC_BLOOD",
    8441: "DIASTOLIC_BLOOD", 8555: "DIASTOLIC_BLOOD", 220180: "DIASTOLIC_BLOOD", 220051: "DIASTOLIC_BLOOD",
    225310: "DIASTOLIC_BLOOD",
    8502: "DIASTOLIC_BLOOD", 456: "MEAN_ARTERIAL", 52: "MEAN_ARTERIAL", 6702: "MEAN_ARTERIAL", 443: "MEAN_ARTERIAL",
    220052: "MEAN_ARTERIAL", 220181: "MEAN_ARTERIAL", 225312: "MEAN_ARTERIAL", 224: "MEAN_ARTERIAL",
    224322: "MEAN_ARTERIAL",
    3312: "MEAN_ARTERIAL", 646: "SpO2", 220277: "SpO2", 807: "GLUCOSE", 811: "GLUCOSE", 1529: "GLUCOSE",
    3745: "GLUCOSE", 3744: "GLUCOSE",
    225664: "GLUCOSE", 220621: "GLUCOSE", 226537: "GLUCOSE", 40055: "URINE_OUTPUT", 43175: "URINE_OUTPUT",
    40069: "URINE_OUTPUT",
    40094: "URINE_OUTPUT", 40715: "URINE_OUTPUT", 40473: "URINE_OUTPUT", 40085: "URINE_OUTPUT", 40057: "URINE_OUTPUT",
    40056: "URINE_OUTPUT",
    40405: "URINE_OUTPUT", 40428: "URINE_OUTPUT", 40086: "URINE_OUTPUT", 40096: "URINE_OUTPUT", 40651: "URINE_OUTPUT",
    226559: "URINE_OUTPUT", 226560: "URINE_OUTPUT", 226561: "URINE_OUTPUT", 226584: "URINE_OUTPUT",
    226563: "URINE_OUTPUT",
    226564: "URINE_OUTPUT", 226565: "URINE_OUTPUT", 226567: "URINE_OUTPUT", 226557: "URINE_OUTPUT",
    226558: "URINE_OUTPUT",
    227488: "URINE_OUTPUT", 227489: "URINE_OUTPUT", 445: "MINUTE_VOLUME", 448: "MINUTE_VOLUME", 449: "MINUTE_VOLUME",
    450: "MINUTE_VOLUME", 1340: "MINUTE_VOLUME", 1486: "MINUTE_VOLUME", 1600: "MINUTE_VOLUME", 224687: "MINUTE_VOLUME",
    639: "TIDAL_VOLUME", 654: "TIDAL_VOLUME", 681: "TIDAL_VOLUME", 682: "TIDAL_VOLUME", 683: "TIDAL_VOLUME",
    684: "TIDAL_VOLUME",
    224685: "TIDAL_VOLUME", 224684: "TIDAL_VOLUME", 224686: "TIDAL_VOLUME", 218: "RESP_PRESSURE", 436: "RESP_PRESSURE",
    535: "RESP_PRESSURE", 444: "RESP_PRESSURE", 459: "RESP_PRESSURE", 224697: "RESP_PRESSURE", 224695: "RESP_PRESSURE",
    224696: "RESP_PRESSURE", 224746: "RESP_PRESSURE", 224747: "RESP_PRESSURE", 221: "INSP_PRESSURE", 1: "INSP_PRESSURE",
    1211: "INSP_PRESSURE", 1655: "INSP_PRESSURE", 2000: "INSP_PRESSURE", 226873: "INSP_PRESSURE",
    224738: "INSP_PRESSURE",
    224419: "INSP_PRESSURE", 224750: "INSP_PRESSURE", 227187: "INSP_PRESSURE", 543: "PLATEAU_PRESSURE",
    5865: "APRV_PRESSURE",
    5866: "APRV_PRESSURE", 224707: "APRV_PRESSURE", 224709: "APRV_PRESSURE", 224705: "APRV_PRESSURE",
    224706: "APRV_PRESSURE",
    60: "PEEP_SET", 437: "PEEP_SET", 505: "PEEP_SET", 506: "PEEP_SET", 686: "PEEP_SET", 220339: "PEEP_SET",
    224700: "PEEP_SET",
    501: "PCV", 502: "PCV", 503: "PCV", 224702: "PCV", 223: "TCPCV", 667: "TCPCV", 668: "TCPCV", 669: "TCPCV",
    670: "TCPCV",
    671: "TCPCV", 672: "TCPCV", 224701: "PSV_LEVEL", 762: "WEIGHT", 763: "WEIGHT", 3723: "WEIGHT", 3580: "WEIGHT",
    226512: "WEIGHT",
    3581: "WEIGHT", 3582: "WEIGHT", 226531: "WEIGHT", 3485: "HEIGHT", 4188: "HEIGHT", 920: "HEIGHT", 1394: "HEIGHT",
    4187: "HEIGHT",
    3486: "HEIGHT", 226707: "HEIGHT", 226730: "HEIGHT", 615: "RESPIRATION_RATE", 618: "RESPIRATION_RATE",
    220210: "RESPIRATION_RATE",
    224690: "RESPIRATION_RATE", 614: "RESPIRATION_RATE", 224689: "RESPIRATION_RATE", 651: "RESPIRATION_RATE",
    224422: "RESPIRATION_RATE",
    619: "RESPIRATION_RATE", 224688: "RESPIRATION_RATE", 470: "O2_FLOW", 471: "O2_FLOW", 227287: "O2_FLOW",
    223834: "O2_FLOW", 227582: "O2_FLOW",
}

MAPPING_DRUGS_VAR = {
    221906: "NOREPINEHRINE", 30120: "NOREPINEHRINE", 30047: "NOREPINEHRINE", 221289: "EPINEPHRINE",
    30119: "EPINEPHRINE", 30044: "EPINEPHRINE", 30309: "EPINEPHRINE", 221749: "PHENYLEPHRINE", 30127: "PHENYLEPHRINE",
    30128: "PHENYLEPHRINE", 222315: "VASOPRESSIN", 30051: "VASOPRESSIN", 221662: "DOPAMINE", 30043: "DOPAMINE",
    30307: "DOPAMINE", 221653: "DOBUTAMINE", 30042: "DOBUTAMINE", 30306: "DOBUTAMINE", 221668: "MIDAZOLAM",
    30124: "MIDAZOLAM", 221744: "FENTANYL", 225942: "FENTANYL", 30118: "FENTANYL", 30308: "FENTANYL", 30149: "FENTANYL",
    222168: "PROPOFOL",
    30131: "PROPOFOL", 221794: "FUROSEMIDE", 30123: "FUROSEMIDE", 221986: "MILRINONE", 30125: "MILRINONE",
    222056: "NITROGLYCERINE",
    30121: "NITROGLYCERINE", 30049: "NITROGLYCERINE", 222051: "NITROPRUSSIDE", 30050: "NITROPRUSSIDE",
    225154: "MORPHINE[SULFATE]",
    30126: "MORPHINE[SULFATE]", 221385: "LORAZEPAM", 30141: "LORAZEPAM", 225153: "LABETALOL", 30122: "LABETALOL",
    221468: "DILTIAZEM", 30115: "DILTIAZEM",
    225147: "ARGATROBAN", 30173: "ARGATROBAN", 225151: "INTEGRELIN", 30142: "INTEGRELIN", 225150: "PRECEDEX",
    30167: "PRECEDEX", 222037: "NATRECOR",
    30172: "NATRECOR", 221429: "ESMOLOL", 30117: "ESMOLOL", 221833: "HYDROMORPHONE", 30163: "HYDROMORPHONE",
    222042: "NICARDIPINE", 30178: "NICARDIPINE",
}
# Mapping lab features with ITEMID:
shared_keys_lab = LAB_VARIABLES.keys() & MAPPING_LABEVENTS_VAR.keys()
labs_features = {k: MAPPING_LABEVENTS_VAR[k].title() for k in shared_keys_lab}
# Mapping vitals signs features with ITEMID:
shared_keys_char = CHART_VARIABLES.keys() & MAPPING_CHARTEVENTS_VAR.keys()
vitals_features = {k: MAPPING_CHARTEVENTS_VAR[k].title() for k in shared_keys_char}
# Mapping drugs features with ITEMID:
drugs_features = {k: MAPPING_DRUGS_VAR[k].title() for k in MAPPING_DRUGS_VAR}

drugs_cols = ["SUBJECT_ID", "HADM_ID", "ICUSTAY_ID", "CHARTTIME", "ITEMID", "VALUE", "VALUENUM", "VALUEUOM"]

features_used = defaultdict(list)
features_types = [labs_features, vitals_features, drugs_features]
for feature in features_types:
    for key, value in feature.items():
        features_used[value].append(key)
all_features = [feature for feature in features_used.keys()]
cols_min = ['Gcs_Motor', 'Gcs_Verbal', 'Platelet_Count', 'Gcs_Eyes', 'Po2', 'Albumin', 'Bands',
            'Calculated_Total_Co2', 'Hematocrit', 'Hemoglobin', 'Lymphocytes', 'Mch', 'Mchc', 'Mcv',
            'Pco2', 'Ph', 'Diastolic_Blood', 'Mean_Arterial', 'Systolic_Blood', 'Heart_Rate', 'Fibrinogen',
            'Sodium', 'Sao2', 'Wbc', 'Spo2']
cols_sum = ['Urine_Output']

cols_statics = ["AGE", "Gender", "Ethnicity", "Comorbidity", "Admission_type"]
targets_cols = ["MORTALITY_INHOSPITAL", "ICU_MORTALITY", "MORTALITY_24HRS",
                "MORTALITY_48HRS", "MORTALITY_72HRS", "MORTALITY_30DAYS",
                "MORTALITY_1_YEAR", "LOS_DAYS"]

features_notes = ["SUBJECT_ID", "HADM_ID", "ICUSTAY_ID", 'PRESENT_ILLNESS',
                  'MEDICAL_HISTORY', 'PERTINENT_RESULTS', 'HOSPITAL_COURSE']

cohort_features = ['Eosinophils', 'Fibrinogen', 'Hematocrit', 'Hemoglobin', 'Inr(Pt)', 'Lymphocytes', 'Monocytes',
                   'Myelocytes', 'Metamyelocytes', 'Neutrophils', "Basophils", 'Platelet_Count', 'Ptt', 'Rbc', 'Reticulocyte_Count',
                   'Wbc', 'Base_Excess', 'Bicarbonate', 'Calculated_Total_Co2', 'Chloride', 'Glucose', 'Lactate',
                   'Fio2', 'Sao2', 'Pco2', 'Ph', 'Po2', 'Potassium', 'Sodium', 'Temperature', 'Alt', 'Albumin', 'Anion_Gap',
                   'Ast', 'Bilirubin', 'Calcium_Total', 'Creatinine', 'Vasopressin', 'Magnesium', 'Phosphate', 'Troponin_T',
                   'Urea', 'Vancomycin_Level', 'D-Dimer', 'Systolic_Blood', 'Diastolic_Blood', 'Mean_Arterial', 'Urine_Output',
                   'Respiration_Rate', 'Gcs_Eyes', 'Spo2', 'Weight', 'Gcs_Verbal', 'Gcs_Motor', 'Heart_Rate',
                   'Norepinehrine', 'Epinephrine', 'Phenylephrine', 'Dopamine', 'Dobutamine']

print(len(set(cohort_features)), len(cohort_features))
